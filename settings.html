<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CICLOPS - Configuracion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700&family=Bricolage+Grotesque:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'pizza': '#FF5722',
                        'pizza-light': '#FF8A65',
                        'pizza-dark': '#E64A19',
                        'midnight': '#0a0a0b',
                        'surface': '#141416',
                        'surface-2': '#1c1c1f',
                        'surface-3': '#242428',
                        'ink': '#ffffff',
                        'ink-2': '#a1a1a6',
                        'ink-3': '#636366',
                        'success': '#34C759',
                        'warning': '#FF9500',
                        'danger': '#FF3B30',
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --pizza: #FF5722;
            --bg: #0a0a0b;
            --surface: #141416;
        }

        * {
            font-family: 'Instrument Sans', system-ui, sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        .font-display {
            font-family: 'Bricolage Grotesque', serif;
            letter-spacing: -0.03em;
        }

        body {
            background: var(--bg);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Morphing blob */
        .blob {
            position: fixed;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(255,87,34,0.15) 0%, transparent 70%);
            filter: blur(60px);
            animation: morph 15s infinite ease-in-out;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes morph {
            0%, 100% { border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; transform: translate(0, 0) rotate(0deg); }
            25% { border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%; transform: translate(50px, -50px) rotate(90deg); }
            50% { border-radius: 50% 60% 30% 60% / 30% 60% 70% 40%; transform: translate(-30px, 50px) rotate(180deg); }
            75% { border-radius: 60% 40% 60% 30% / 70% 30% 50% 60%; transform: translate(30px, 20px) rotate(270deg); }
        }

        /* Glassmorphism Nav Container */
        .glass-nav {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.375rem;
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 100px;
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow: 0 4px 30px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.05);
        }

        .nav-pill {
            position: relative;
            padding: 0.625rem 1.125rem;
            border-radius: 100px;
            font-weight: 500;
            font-size: 0.875rem;
            color: rgba(255,255,255,0.5);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-pill.active {
            color: #fff;
            background: linear-gradient(135deg, #FF5722 0%, #E64A19 100%);
            box-shadow: 0 2px 12px rgba(255,87,34,0.4);
        }

        .nav-pill:not(.active):hover {
            color: rgba(255,255,255,0.85);
            background: rgba(255,255,255,0.08);
        }

        /* Settings Card */
        .settings-card {
            background: linear-gradient(145deg, #18181b 0%, #0f0f11 100%);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        /* Input styles */
        .input-field {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 0.875rem 1rem;
            color: #fff;
            font-size: 0.9375rem;
            transition: all 0.2s;
        }

        .input-field:focus {
            outline: none;
            border-color: rgba(255,87,34,0.5);
            box-shadow: 0 0 0 3px rgba(255,87,34,0.15);
        }

        .input-field::placeholder {
            color: #636366;
        }

        /* Mobile nav */
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(10,10,11,0.9);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255,255,255,0.05);
            padding: 0.75rem 1rem;
            z-index: 100;
            display: none;
        }

        @media (max-width: 1024px) {
            .mobile-nav { display: flex; justify-content: space-around; }
            .desktop-nav { display: none; }
            body { padding-bottom: 80px; }
        }

        /* Light theme */
        .theme-light {
            --bg: #f8f8fa;
            --surface: #ffffff;
            background: linear-gradient(180deg, #f8f8fa 0%, #f0f0f2 100%) !important;
        }

        .theme-light .settings-card {
            background: #ffffff;
            border: 1px solid rgba(0,0,0,0.06);
            box-shadow: 0 1px 2px rgba(0,0,0,0.04), 0 4px 16px rgba(0,0,0,0.06);
        }

        .theme-light .input-field {
            background: #f8f8fa;
            border-color: rgba(0,0,0,0.1);
            color: #1a1a1a;
        }

        .theme-light .input-field:focus {
            border-color: rgba(255,87,34,0.4);
            box-shadow: 0 0 0 3px rgba(255,87,34,0.1);
        }

        .theme-light .text-ink { color: #1a1a1a; }
        .theme-light .text-ink-2 { color: #525252; }
        .theme-light .text-ink-3 { color: #787878; }

        .theme-light .glass-nav {
            background: rgba(255,255,255,0.7);
            border-color: rgba(0,0,0,0.08);
            box-shadow: 0 4px 30px rgba(0,0,0,0.08), inset 0 1px 0 rgba(255,255,255,0.9);
        }
        .theme-light .nav-pill:not(.active) { color: #525252; }
        .theme-light .nav-pill:not(.active):hover {
            color: #1a1a1a;
            background: rgba(0,0,0,0.06);
        }

        .theme-light .blob {
            background: radial-gradient(circle, rgba(255,87,34,0.06) 0%, transparent 70%);
            filter: blur(80px);
        }

        .theme-light .mobile-nav {
            background: rgba(255,255,255,0.95);
            border-top-color: rgba(0,0,0,0.08);
        }
    </style>
</head>
<body class="text-ink" id="app">
    <!-- Morphing Background -->
    <div class="blob -top-48 -right-48"></div>
    <div class="blob -bottom-48 -left-48" style="animation-delay: -7s;"></div>

    <!-- Desktop Navigation -->
    <header class="desktop-nav fixed top-0 left-0 right-0 z-50 px-6 py-4">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <!-- Logo -->
            <a href="/" class="flex items-center gap-3 group">
                <div class="w-11 h-11 rounded-2xl bg-gradient-to-br from-pizza to-pizza-dark flex items-center justify-center shadow-lg shadow-pizza/30 group-hover:scale-105 transition-transform">
                    <svg class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <circle cx="12" cy="12" r="10"/>
                        <circle cx="12" cy="12" r="4"/>
                        <line x1="12" y1="2" x2="12" y2="6"/>
                        <line x1="12" y1="18" x2="12" y2="22"/>
                        <line x1="2" y1="12" x2="6" y2="12"/>
                        <line x1="18" y1="12" x2="22" y2="12"/>
                    </svg>
                </div>
                <div>
                    <span class="font-display text-xl font-bold text-ink">CICLOPS</span>
                    <span class="block text-[10px] text-ink-3 tracking-[0.2em] uppercase">Little Caesars Intel</span>
                </div>
            </a>

            <!-- Nav Pills - Glassmorphism -->
            <nav class="glass-nav">
                <a href="/" class="nav-pill">
                    <span class="flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7" rx="2"/>
                            <rect x="14" y="3" width="7" height="7" rx="2"/>
                            <rect x="3" y="14" width="7" height="7" rx="2"/>
                            <rect x="14" y="14" width="7" height="7" rx="2"/>
                        </svg>
                        Dashboard
                    </span>
                </a>
                <a href="/upload" class="nav-pill">
                    <span class="flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        Subir
                    </span>
                </a>
                <a href="/graficas" class="nav-pill">
                    <span class="flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"/>
                            <line x1="12" y1="20" x2="12" y2="4"/>
                            <line x1="6" y1="20" x2="6" y2="14"/>
                        </svg>
                        Graficas
                    </span>
                </a>
                <a href="/julia" class="nav-pill">
                    <span class="flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                        </svg>
                        Julia
                    </span>
                </a>
                <a href="/documents" class="nav-pill">
                    <span class="flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                        </svg>
                        Vault
                    </span>
                </a>
            </nav>

            <!-- Actions -->
            <div class="flex items-center gap-3">
                <!-- Theme Toggle -->
                <button onclick="toggleTheme()" class="w-10 h-10 rounded-xl bg-surface-2 border border-white/5 flex items-center justify-center text-ink-3 hover:text-ink hover:border-white/10 transition-all" title="Cambiar tema">
                    <svg class="w-5 h-5 theme-icon-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <line x1="12" y1="1" x2="12" y2="3"/>
                        <line x1="12" y1="21" x2="12" y2="23"/>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                        <line x1="1" y1="12" x2="3" y2="12"/>
                        <line x1="21" y1="12" x2="23" y2="12"/>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                    </svg>
                    <svg class="w-5 h-5 theme-icon-light hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                </button>

                <!-- User Menu -->
                <div class="flex items-center gap-3 pl-3 border-l border-white/10">
                    <a href="/profile" class="flex items-center gap-2 p-1 rounded-xl hover:bg-surface-3/50 transition-all">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-pizza to-pizza-dark flex items-center justify-center text-white font-bold text-sm">
                            LC
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
        <a href="/" class="flex flex-col items-center gap-1 text-ink-3">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                <rect x="3" y="3" width="7" height="7" rx="2"/>
                <rect x="14" y="3" width="7" height="7" rx="2"/>
                <rect x="3" y="14" width="7" height="7" rx="2"/>
                <rect x="14" y="14" width="7" height="7" rx="2"/>
            </svg>
            <span class="text-[10px] font-medium">Dashboard</span>
        </a>
        <a href="/upload" class="flex flex-col items-center gap-1 text-ink-3">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
            <span class="text-[10px] font-medium">Subir</span>
        </a>
        <a href="/julia" class="flex flex-col items-center gap-1 text-ink-3">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
            </svg>
            <span class="text-[10px] font-medium">Julia</span>
        </a>
    </nav>

    <!-- Main Content -->
    <main class="relative z-10 pt-28 pb-8 px-4 sm:px-6 lg:px-8">
        <div class="max-w-2xl mx-auto">
            <!-- Header -->
            <div class="mb-8">
                <h1 class="font-display text-3xl sm:text-4xl font-bold text-ink mb-2">Configuracion</h1>
                <p class="text-ink-3">Administra tus API keys y preferencias del sistema</p>
            </div>

            <!-- Alert Container -->
            <div id="alertContainer" class="hidden mb-6 p-4 rounded-xl"></div>

            <!-- AI Settings Card -->
            <div class="settings-card p-6 mb-6">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-purple-500 to-purple-700 flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                            <path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z"/>
                            <circle cx="7.5" cy="14.5" r="1.5"/>
                            <circle cx="16.5" cy="14.5" r="1.5"/>
                        </svg>
                    </div>
                    <div>
                        <h2 class="font-display text-xl font-bold text-ink">Inteligencia Artificial</h2>
                        <p class="text-sm text-ink-3">Configura las APIs de AI para Julia</p>
                    </div>
                </div>

                <!-- Anthropic API Key -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-ink-2 mb-2">
                        Anthropic API Key (Claude)
                    </label>
                    <div class="flex gap-3">
                        <div class="flex-1 relative">
                            <input
                                type="password"
                                id="anthropicKey"
                                class="input-field w-full pr-10"
                                placeholder="sk-ant-..."
                            >
                            <button onclick="toggleKeyVisibility('anthropicKey')" class="absolute right-3 top-1/2 -translate-y-1/2 text-ink-3 hover:text-ink transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <p class="mt-2 text-xs text-ink-3">
                        Obten tu API key en <a href="https://console.anthropic.com/" target="_blank" class="text-pizza hover:underline">console.anthropic.com</a>
                    </p>
                    <div id="anthropicStatus" class="mt-2 hidden">
                        <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium">
                            <span class="w-2 h-2 rounded-full"></span>
                            <span class="status-text"></span>
                        </span>
                    </div>
                </div>

                <!-- OpenAI API Key (existing) -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-ink-2 mb-2">
                        OpenAI API Key
                    </label>
                    <div class="flex gap-3">
                        <div class="flex-1 relative">
                            <input
                                type="password"
                                id="openaiKey"
                                class="input-field w-full pr-10"
                                placeholder="sk-..."
                            >
                            <button onclick="toggleKeyVisibility('openaiKey')" class="absolute right-3 top-1/2 -translate-y-1/2 text-ink-3 hover:text-ink transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <p class="mt-2 text-xs text-ink-3">
                        Obten tu API key en <a href="https://platform.openai.com/api-keys" target="_blank" class="text-pizza hover:underline">platform.openai.com</a>
                    </p>
                    <div id="openaiStatus" class="mt-2 hidden">
                        <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium">
                            <span class="w-2 h-2 rounded-full"></span>
                            <span class="status-text"></span>
                        </span>
                    </div>
                </div>

                <!-- AI Provider Selection -->
                <div class="mb-6 p-4 rounded-xl bg-surface-3/30 border border-white/5">
                    <label class="block text-sm font-medium text-ink-2 mb-3">
                        Proveedor AI para Julia
                    </label>
                    <div class="flex gap-3">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="aiProvider" value="anthropic" class="sr-only peer">
                            <div class="p-4 rounded-xl border border-white/10 peer-checked:border-pizza peer-checked:bg-pizza/10 transition-all">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 rounded-lg bg-purple-500/20 flex items-center justify-center">
                                        <span class="text-purple-400 font-bold text-sm">C</span>
                                    </div>
                                    <div>
                                        <p class="font-medium text-ink text-sm">Claude</p>
                                        <p class="text-xs text-ink-3">Anthropic</p>
                                    </div>
                                </div>
                            </div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="aiProvider" value="openai" class="sr-only peer" checked>
                            <div class="p-4 rounded-xl border border-white/10 peer-checked:border-pizza peer-checked:bg-pizza/10 transition-all">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 rounded-lg bg-green-500/20 flex items-center justify-center">
                                        <span class="text-green-400 font-bold text-sm">G</span>
                                    </div>
                                    <div>
                                        <p class="font-medium text-ink text-sm">GPT-4</p>
                                        <p class="text-xs text-ink-3">OpenAI</p>
                                    </div>
                                </div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Save Button -->
                <button onclick="saveSettings()" id="saveBtn" class="w-full py-3 px-6 bg-gradient-to-r from-pizza to-pizza-dark text-white font-semibold rounded-xl shadow-lg shadow-pizza/25 hover:shadow-pizza/40 hover:scale-[1.02] transition-all">
                    Guardar configuracion
                </button>
            </div>

            <!-- Connection Status Card -->
            <div class="settings-card p-6">
                <h3 class="font-display text-lg font-bold text-ink mb-4">Estado de conexion</h3>
                <div class="space-y-3">
                    <div class="flex items-center justify-between p-3 rounded-xl bg-surface-3/30">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-lg bg-green-500/20 flex items-center justify-center">
                                <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                    <polyline points="22 4 12 14.01 9 11.01"/>
                                </svg>
                            </div>
                            <span class="text-ink-2">Backend API</span>
                        </div>
                        <span id="backendStatus" class="text-sm text-green-400">Conectado</span>
                    </div>
                    <div class="flex items-center justify-between p-3 rounded-xl bg-surface-3/30">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-lg bg-blue-500/20 flex items-center justify-center">
                                <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                                </svg>
                            </div>
                            <span class="text-ink-2">Firebase Auth</span>
                        </div>
                        <span id="firebaseStatus" class="text-sm text-green-400">Conectado</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>

    <script>
        const API = 'https://lc.calidevs.com';

        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyBL8-hBMJR6NlnXN6rWwS8WVcrdMm7m4rY",
            authDomain: "ciclops-8a2de.firebaseapp.com",
            projectId: "ciclops-8a2de",
            storageBucket: "ciclops-8a2de.firebasestorage.app",
            messagingSenderId: "475876958824",
            appId: "1:475876958824:web:5ecc315220c66fdd56d1dd"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // Theme Toggle
        function toggleTheme() {
            const body = document.getElementById('app');
            const isDark = !body.classList.contains('theme-light');

            if (isDark) {
                body.classList.add('theme-light');
                document.querySelector('.theme-icon-dark').classList.add('hidden');
                document.querySelector('.theme-icon-light').classList.remove('hidden');
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.remove('theme-light');
                document.querySelector('.theme-icon-dark').classList.remove('hidden');
                document.querySelector('.theme-icon-light').classList.add('hidden');
                localStorage.setItem('theme', 'dark');
            }
        }

        // Load saved theme
        if (localStorage.getItem('theme') === 'light') {
            document.getElementById('app').classList.add('theme-light');
            document.querySelector('.theme-icon-dark')?.classList.add('hidden');
            document.querySelector('.theme-icon-light')?.classList.remove('hidden');
        }

        // Toggle password visibility
        function toggleKeyVisibility(inputId) {
            const input = document.getElementById(inputId);
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        // Show alert
        function showAlert(message, type = 'success') {
            const container = document.getElementById('alertContainer');
            const bgColor = type === 'success' ? 'bg-green-500/10 border border-green-500/20 text-green-400' : 'bg-red-500/10 border border-red-500/20 text-red-400';
            container.className = `mb-6 p-4 rounded-xl ${bgColor}`;
            container.textContent = message;
            container.classList.remove('hidden');
            setTimeout(() => container.classList.add('hidden'), 5000);
        }

        // Load settings from backend
        async function loadSettings() {
            try {
                const response = await fetch(API + '/settings');
                if (!response.ok) throw new Error('Failed to load settings');

                const settings = await response.json();

                // Populate fields (masked for security)
                if (settings.anthropic_key_set) {
                    document.getElementById('anthropicKey').placeholder = '••••••••••••••••';
                    showKeyStatus('anthropicStatus', true);
                }
                if (settings.openai_key_set) {
                    document.getElementById('openaiKey').placeholder = '••••••••••••••••';
                    showKeyStatus('openaiStatus', true);
                }

                // Set AI provider
                if (settings.ai_provider) {
                    document.querySelector(`input[name="aiProvider"][value="${settings.ai_provider}"]`).checked = true;
                }
            } catch (e) {
                console.log('No settings saved yet or error loading:', e);
            }
        }

        // Show key status
        function showKeyStatus(elementId, isSet) {
            const container = document.getElementById(elementId);
            const dot = container.querySelector('.w-2');
            const text = container.querySelector('.status-text');

            if (isSet) {
                container.classList.remove('hidden');
                container.querySelector('span').className = 'inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium bg-green-500/10 text-green-400';
                dot.classList.add('bg-green-400');
                text.textContent = 'Configurada';
            } else {
                container.classList.add('hidden');
            }
        }

        // Save settings to backend
        async function saveSettings() {
            const btn = document.getElementById('saveBtn');
            btn.disabled = true;
            btn.textContent = 'Guardando...';

            try {
                const anthropicKey = document.getElementById('anthropicKey').value;
                const openaiKey = document.getElementById('openaiKey').value;
                const aiProvider = document.querySelector('input[name="aiProvider"]:checked').value;

                const response = await fetch(API + '/settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        anthropic_key: anthropicKey || null,
                        openai_key: openaiKey || null,
                        ai_provider: aiProvider
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Error al guardar');
                }

                const result = await response.json();
                showAlert('Configuracion guardada correctamente');

                // Update status indicators
                if (anthropicKey) showKeyStatus('anthropicStatus', true);
                if (openaiKey) showKeyStatus('openaiStatus', true);

                // Clear input values (security)
                document.getElementById('anthropicKey').value = '';
                document.getElementById('openaiKey').value = '';
                document.getElementById('anthropicKey').placeholder = '••••••••••••••••';
                document.getElementById('openaiKey').placeholder = '••••••••••••••••';

            } catch (e) {
                showAlert('Error: ' + e.message, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Guardar configuracion';
            }
        }

        // Check backend connection
        async function checkBackendConnection() {
            try {
                const response = await fetch(API + '/health');
                if (response.ok) {
                    document.getElementById('backendStatus').textContent = 'Conectado';
                    document.getElementById('backendStatus').className = 'text-sm text-green-400';
                } else {
                    throw new Error('Not healthy');
                }
            } catch (e) {
                document.getElementById('backendStatus').textContent = 'Desconectado';
                document.getElementById('backendStatus').className = 'text-sm text-red-400';
            }
        }

        // Auth state
        auth.onAuthStateChanged(function(user) {
            if (!user) {
                window.location.href = '/login';
                return;
            }
            document.getElementById('firebaseStatus').textContent = 'Conectado';
        });

        // Init
        loadSettings();
        checkBackendConnection();
    </script>
</body>
</html>
